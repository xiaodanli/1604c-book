require(["jquery","swiper","bscroll","GetSlideDirection","render","text!bookTB","text!indexTpl","text!bookLR","storage"],function(n,i,e,a,c,t,o,r,s){console.log(t),n("body").append(o),n("body").append(t),n("body").append(r);var l=n(".line"),d=n(".book-city>div"),u=new e(".book-city",{probeType:2,click:!0}),p=document.getElementsByTagName("html")[0].style.fontSize,m=44*parseInt(p)/37.5;u.on("scroll",function(){this.y<this.maxScrollY-m?v<b?d.attr("up","释放加载更多"):d.attr("up","已经到底"):this.y<this.maxScrollY-m/2?v<b?d.attr("up","上拉加载"):d.attr("up","已经到底"):this.y>m&&d.attr("down","释放刷新")});var h,f,g,v=1,b=3;function y(e){n.ajax({url:"/api/recommend?pagenum="+e,dataType:"json",success:function(e){console.log(e),1===e.code&&(c("#l-r-tpl",".loadmore",e.data.items),u.refresh())},error:function(e){console.warn(e)}})}function w(e){h.slideTo(e),n(".tab-item").eq(e).addClass("active").siblings().removeClass("active"),1==e?l.addClass("move"):l.removeClass("move")}u.on("touchEnd",function(){"释放加载更多"===d.attr("up")?(console.log("上拉加载更多"),v<b?(y(++v),d.attr("up","上拉加载")):d.attr("up","已经到底")):"释放刷新"===d.attr("down")&&location.reload()}),y(v),document.addEventListener("touchstart",function(e){f=e.touches[0].pageX,g=e.touches[0].pageY},!1),document.addEventListener("touchend",function(e){var t,o;switch(t=e.changedTouches[0].pageX,o=e.changedTouches[0].pageY,a(f,g,t,o)){case 3:console.log("xiangzuo"),w(1);break;case 4:console.log("xiangyou"),w(0)}},!1),n(".tab-wrap").on("click",".tab-item",function(){var e=n(this).index();n(this).addClass("active").siblings().removeClass("active"),1==e?l.addClass("move"):l.removeClass("move"),h.slideTo(e)});new i(".banner-wrap",{autoplay:3e3,loop:!0});n.ajax({url:"/api/index",dataType:"json",success:function(e){console.log(e),1===e.code&&function(e){var t=e.items[0].data.data.filter(function(e){return 0!=e.size});c("#banner-tpl",".banner",t);var o=e.items[0].data.data.filter(function(e){return 0==e.size});c("#type-tpl",".types",o);var a=e.items[1].data.data;c("#book-t-b",".hot",a),k=function(e,t){for(var o=Math.ceil(e.length/5),a=[],n=0;n<o;n++)a.push(e.splice(0,5));return a}(e.items[2].data.data),c("#recommend-tpl",".recommed",k[0],!0),n(".content").show(),h=new i(".wrap-swiper"),u.refresh()}(e.data)},error:function(e){console.warn(e)}});var k=[];var x=0;n(".change-btn").on("click",function(){++x===k.length&&(x=0),c("#recommend-tpl",".recommed",k[x],!0)}),n(".switch-btn").on("click",function(){n(".shelf-list").toggleClass("change-style")}),n(".types").on("click","dl",function(){var e,t=n(this).find("dd").text();"女生"==t?e="female":"男生"==t&&(e="man"),location.href="../../page/list.html?type="+e}),n(".hot").on("click","li",function(){var e=n(this).attr("data-id");location.href="../../page/detail.html?fiction_id="+e}),n(".icon-person").on("click",function(){var e=s.get("code")||0;location.href=e?"../../page/my.html":"../../page/login.html"})});
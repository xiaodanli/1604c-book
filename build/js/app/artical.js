require(["jquery","storage","getRequest","base64","render"],function(a,o,t,c,s){var e=a(".set-wrap"),n=a(".set-panel"),l=o.get("fz")||14,i=t.fiction_id,r=o.get(i)||1,d=o.get(i+"alreay")||[];function f(n,i){a.ajax({url:"/api/artical?fiction_id="+n+"&chapter_id="+i,dataType:"json",success:function(t){var c=t.data.jsonp,e=document.createElement("script");e.src=c,window.duokan_fiction_chapter=function(t){var c=JSON.parse(a.base64().decode(t));s("#artical-tpl",".artical-con",c,!0),a(".artical-con p").css("fontSize",l/37.5*1+"rem"),-1==d.indexOf(i)&&(d.push(i),o.set(n+"alreay",d))},document.body.appendChild(e)},error:function(t){console.log(t)}})}a(".cur").html(r),f(i,r),a(".next-btn").on("click",function(){r<4?(r++,a(".cur").html(r),f(i,r)):alert("已经到最后一章"),o.set(i,r)}),a(".prev-btn").on("click",function(){1<r?(r--,a(".cur").html(r),f(i,r)):alert("已经到第一章"),o.set(i,r)}),a.ajax({url:"/api/chapterList?fiction_id="+i,dataType:"json",success:function(t){console.log(t),1===t.code&&a(".total").html(t.data.item.toc.length)},error:function(t){console.log(t)}}),a(".chapter-btn").on("click",function(){location.href="../../page/chapter-list.html?fiction_id="+i+"&chapter_id="+r}),a(".icon-circle-back").on("click",function(){location.href="../../page/detail.html?fiction_id="+i}),a(".artical-con").on("click",function(){e.show()}),a(".mask").on("click",function(){e.hide(),n.hide(),a(".font-btn").removeClass("active")}),a(".font-btn").on("click",function(){n.toggle(),a(this).toggleClass("active")}),a(".big-btn").on("click",function(){l<30&&(l+=2),o.set("fz",l),a(".artical-con p").css("fontSize",l/37.5*1+"rem")}),a(".small-btn").on("click",function(){10<l&&(l-=2),o.set("fz",l),a(".artical-con p").css("fontSize",l/37.5*1+"rem")});var u="夜间"===(o.get("tag")||"夜间"),g=o.get("bg")||"#f7eee5",h=o.get("index")||0,b=a(".day-btn"),p=a(".artical-con"),m=a(".set-bg li");function v(){b.find("dd").text("夜间"),b.removeClass("light"),p.css("background",g),m.eq(h).addClass("active").siblings().removeClass("active")}function k(){b.find("dd").text("白天"),b.addClass("light"),p.css("background","#0f1410"),m.eq(5).addClass("active").siblings().removeClass("active")}u?v():k(),a(".set-bg").on("click","li",function(){g=a(this).attr("data-bg"),h=a(this).index(),u&&a(".artical-con").css("background",g),a(this).addClass("active").siblings().removeClass("active"),o.set("bg",g),o.set("index",h)}),a(".day-btn").on("click",function(){(u=!u)?v():k();var t=u?"夜间":"白天";o.set("tag",t)})});